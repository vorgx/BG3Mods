
function SuccessRate(threshold)
    local random_num = math.random(1,100)
    return ConditionResult(random_num <= threshold)
end

function DexModifiedProcRate(threshold)
    local random_num = math.random(1,100)

    return ConditionResult(random_num <= threshold + GetModifier(context.Source.Dexterity))
end

function IsInDemonForm(entity)
    local entity = entity or context.Source
    return (HasStatus('WoWDH_POLYMORPH_DEMONFORM_M',entity)|HasStatus('WoWDH_POLYMORPH_DEMONFORM_F',entity)|HasStatus('WoWDH_POLYMORPH_DEMONFORM_V_M',entity)|HasStatus('WoWDH_POLYMORPH_DEMONFORM_V_F',entity))
end

function IsChaosStrike()
    return (SpellId('Target_DH_ChaosStrike')|SpellId('Interrupt_DH_ChaosStrike')|SpellId('Interrupt_DH_ChaosStrike_Critical'))
end


function IsBladeDance()
    return (SpellId('Shout_DH_BladeDance')|SpellId('Shout_DH_BladeDance_Temp'))
end

function IsEyeBeam()
    return (SpellId('Zone_DH_EyeBeam')|SpellId('Zone_DH_EyeBeam_Temp'))
end

function IsFelDevastation()
    return (SpellId('Zone_DH_FelDevastation')|SpellId('Zone_DH_FelDevastation_Temp'))
end


function IsDemonHunterStrikes()
    return (SpellId('Target_DH_ChaosStrike')|SpellId('Target_DH_DemonsBite')|IsBladeDance()|SpellId('Rush_DH_FelRush')|SpellId('Projectile_DH_ThrowGlaive')|SpellId('Projectile_DH_ThrowGlaive_Bounce')|SpellId('Projectile_DH_ThrowGlaive_Bounce2')|SpellId('Projectile_DH_ThrowGlaive_Bounce3')|IsEyeBeam()|IsFelDevastation())
end

function HasMaximumSoulFragment(entity)
    local entity = entity or context.Source
    return ConditionResult(GetStatusDuration('DH_Buff_Havoc_SoulFragment', entity) >= 5)
end

function HasMaxVengeanceSoulFragment(entity)
    local entity = entity or context.Source
    return ConditionResult(GetStatusDuration('DH_Buff_Vengeance_SoulFragment', entity) >= 5)
end

function NextShearMaxSoulFragment(entity)
    local entity = entity or context.Source
    return ConditionResult(GetStatusDuration('DH_Buff_Vengeance_SoulFragment', entity) >= 4)
end

function GetSoulFragment(entity,Amount)
    local entity = entity or context.Source
    return ConditionResult(GetStatusDuration('DH_Buff_Vengeance_SoulFragment', entity) >= Amount)
end

function NegativeFelDevastationCD()
    return ConditionResult(GetStatusDuration('DH_CD_FelDevastation', context.Source) <= 0)
end


function HasAzzinothWarglaives()
    return (HasStatus('DH_AzzinothWarGlaive_R_Tag',context.Source) & HasStatus('DH_AzzinothWarGlaive_L_Tag',context.Source))
end

function ManaBurnHighestSpellLevel(threshold)  
    if threshold == 6 then
        return (HasActionResource('SpellSlot', 1, 6, false, false, context.Target))
    end
    if threshold == 5 then
        return (HasActionResource('SpellSlot', 1, 5, false, false, context.Target) & ~HasActionResource('SpellSlot', 1, 6, false, false, context.Target))
    end
    if threshold == 4 then
        return (HasActionResource('SpellSlot', 1, 4, false, false, context.Target) & ~(HasActionResource('SpellSlot', 1, 5, false, false, context.Target)|HasActionResource('SpellSlot', 1, 6, false, false, context.Target)))
    end
    if threshold == 3 then
        return (HasActionResource('SpellSlot', 1, 3, false, false, context.Target) & ~(HasActionResource('SpellSlot', 1, 4, false, false, context.Target)|HasActionResource('SpellSlot', 1, 5, false, false, context.Target)|HasActionResource('SpellSlot', 1, 6, false, false, context.Target)))
    end
    if threshold == 2 then
        return (HasActionResource('SpellSlot', 1, 2, false, false, context.Target) & ~(HasActionResource('SpellSlot', 1, 3, false, false, context.Target)|HasActionResource('SpellSlot', 1, 4, false, false, context.Target)|HasActionResource('SpellSlot', 1, 5, false, false, context.Target)|HasActionResource('SpellSlot', 1, 6, false, false, context.Target)))
    end
    if threshold == 1 then
        return (HasActionResource('SpellSlot', 1, 1, false, false, context.Target) & ~(HasActionResource('SpellSlot', 1, 2, false, false, context.Target)|HasActionResource('SpellSlot', 1, 3, false, false, context.Target)|HasActionResource('SpellSlot', 1, 4, false, false, context.Target)|HasActionResource('SpellSlot', 1, 5, false, false, context.Target)|HasActionResource('SpellSlot', 1, 6, false, false, context.Target)))
    end
    if threshold == 0 then
        return (~(HasActionResource('SpellSlot', 1, 1, false, false, context.Target)|HasActionResource('SpellSlot', 1, 2, false, false, context.Target)|HasActionResource('SpellSlot', 1, 3, false, false, context.Target)|HasActionResource('SpellSlot', 1, 4, false, false, context.Target)|HasActionResource('SpellSlot', 1, 5, false, false, context.Target)|HasActionResource('SpellSlot', 1, 6, false, false, context.Target)))
    end
end

function ManaBurnHighestWarlockSpellLevel(threshold)  
    if threshold == 5 then
        return (HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target))
    end
    if threshold == 4 then
        return (HasActionResource('WarlockSpellSlot', 1, 4, false, false, context.Target) & ~(HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target)))
    end
    if threshold == 3 then
        return (HasActionResource('WarlockSpellSlot', 1, 3, false, false, context.Target) & ~(HasActionResource('WarlockSpellSlot', 1, 4, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target)))
    end
    if threshold == 2 then
        return (HasActionResource('WarlockSpellSlot', 1, 2, false, false, context.Target) & ~(HasActionResource('WarlockSpellSlot', 1, 3, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 4, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target)))
    end
    if threshold == 1 then
        return (HasActionResource('WarlockSpellSlot', 1, 1, false, false, context.Target) & ~(HasActionResource('WarlockSpellSlot', 1, 2, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 3, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 4, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target)))
    end
    if threshold == 0 then
        return (~(HasActionResource('WarlockSpellSlot', 1, 1, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 2, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 3, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 4, false, false, context.Target)|HasActionResource('WarlockSpellSlot', 1, 5, false, false, context.Target)))
    end
end

function ManaBurnHighestSorceryPoint(threshold) 
    if threshold == 4 then
        return (HasActionResource('SorceryPoint', 4, 0, false, false, context.Target))
    end
    if threshold == 3 then
        return (HasActionResource('SorceryPoint', 3, 0, false, false, context.Target) & ~(HasActionResource('SorceryPoint', 4, 0, false, false, context.Target)))
    end 
    if threshold == 2 then
        return (HasActionResource('SorceryPoint', 2, 0, false, false, context.Target) & ~(HasActionResource('SorceryPoint', 3, 0, false, false, context.Target)|HasActionResource('SorceryPoint', 4, 0, false, false, context.Target)))
    end
    if threshold == 1 then
        return (HasActionResource('SorceryPoint', 1, 0, false, false, context.Target) & ~(HasActionResource('SorceryPoint', 2, 0, false, false, context.Target)|HasActionResource('SorceryPoint', 3, 0, false, false, context.Target)|HasActionResource('SorceryPoint', 4, 0, false, false, context.Target)))
    end
    if threshold == 0 then
        return (~(HasActionResource('SorceryPoint', 1, 0, false, false, context.Target)))
    end
end

function MetamorphosisIsPlayer()
        return helpers.IsControlledByLocalPlayer(context.Source)
end


function IsBeingAttacked()
    return SpellDamageTypeIs(DamageType.Acid)|SpellDamageTypeIs(DamageType.Cold)|SpellDamageTypeIs(DamageType.Slashing)|SpellDamageTypeIs(DamageType.Piercing)|SpellDamageTypeIs(DamageType.Bludgeoning)
end

function FelBloodDexInterval(threshold)
    return ConditionResult(GetModifier(context.Source.Dexterity) >= threshold)
end     