# BG3Wow - WoW Classes for BG3 Modding Project

## üî¥ CRITICAL: Read These First

1. **SOURCE_OF_TRUTH.md** (Primary Reference)
   - File: `Documentation/00_SourcesOfTruth/SOURCE_OF_TRUTH.md`
   - Purpose: Single authoritative source for ALL project information
   - Current Status: 69.2% complete (9/13 sections)
   - **ALWAYS read relevant section BEFORE making changes**

2. **Current Session Context**
   - File: `HANDOVER_NEXT_SESSION_OCT21.md`
   - Purpose: Session-to-session continuity, current priorities
   - Next Actions: Section [6] Progression (in-progress) OR FILE 3 transformation

3. **Ability Database** (Implementation Reference)
   - File: `Documentation/00_SourcesOfTruth/AbilityDatabase_Warrior_FullyEnriched.csv`
   - Purpose: 215 abilities with WoW‚ÜíBG3 mechanics, 100% enriched
   - **ALWAYS consult BEFORE implementing abilities**

4. **Progression Source Data** (Excel Reference)
   - File: `Documentation/00_SourcesOfTruth/Warrior Progression for all subclasses and Default hero structure.csv`
   - Purpose: Complete L1-20 progression tables, baseline abilities, talent rows, hero talents
   - Columns: Arms (4-5), Protection (6-8), Fury (9-10), Class Talents (11-23), Spec Talents (24-55), Hero Talents (56-64)
   - **ALWAYS use as source when building progression tables or FILE 11 (Progressions.lsx)**

## üéØ Project Overview

**What**: BG3 mod implementing WoW Warrior class (3 subclasses, 215 abilities, Rage resource)  
**Current Phase**: Documentation completion (69.2%) + File-by-file transformation (FILES 1-2 complete)  
**Mod UUID**: `78fe4967-4e62-5491-d981-dd781acca4d7`  
**Template Source**: WoWWarlock mod (UUID: `bdb3fa73-401b-4979-f02e-485422dd8d9c`)

## üõ†Ô∏è Technology Stack

- **BG3 Modding Framework**: LSX files (XML-like), TXT stat files (Larian format)
- **Packaging**: LSLib Divine.exe (v1.20.3+), package version v18, LZ4 compression
- **Testing**: PowerShell validation scripts (`Transformation_Templates/Tests/`)
- **Documentation**: Markdown (living documents), CSV databases, Excel sources

## üìÇ Critical File Locations

### **Source of Truth Files** (Read Before Changes)
- `Documentation/00_SourcesOfTruth/SOURCE_OF_TRUTH.md` - Master documentation (4,350 lines)
- `Documentation/00_SourcesOfTruth/AbilityDatabase_Warrior_FullyEnriched.csv` - Ability definitions (215 abilities)
- `Documentation/00_SourcesOfTruth/Warrior Progression for all subclasses and Default hero structure.csv` - Excel source (L1-20 progression)

### **Implementation Files** (Transform from Template)
- `Data/Mods/BG3Wow_*/meta.lsx` - Mod metadata
- `Data/Public/BG3Wow_*/ClassDescriptions/ClassDescriptions.lsx` - Class definitions
- `Data/Public/BG3Wow_*/Progressions.lsx` - Level progression (L1-20)
- `Data/Public/BG3Wow_*/Stats/Generated/Data/*.txt` - Ability stat files

### **Reference Documentation**
- `Documentation/01_Reference-Guides/BG3_SPELL_GRANT_APPROACHES.md` - Spell grant patterns
- `Documentation/01_Reference-Guides/FILE_REFERENCE.md` - BG3 file format syntax
- `Transformation_Templates/README.md` - File transformation plan (FILES 1-15)

### **Session Continuity**
- `HANDOVER_NEXT_SESSION_OCT21.md` - Current session context
- `Documentation/10_SessionSummaries/` - Completed session reports

## üö® MANDATORY PROTOCOLS

### **1. SOURCE OF TRUTH PROTOCOL** (ALWAYS FOLLOW)
**Pre-Change**:
1. Read `SOURCE_OF_TRUTH.md` relevant section
2. Use as baseline for current state
3. Proceed with change

**Post-Change**:
1. Update `SOURCE_OF_TRUTH.md` with new information
2. Update "Last Updated" timestamp
3. Add change log entry with date + reason
4. If creating files, update [12] Folder Structure Inventory

### **2. File-by-File Transformation Workflow** (FILES 1-15)
When transforming template files:
1. **Analyze**: Read WoWWarlock template file
2. **Review**: Present side-by-side comparison (Warlock vs Warrior)
3. **Approve**: **WAIT for explicit user approval** (never skip!)
4. **Transform**: Make changes with exact naming (`WAR_*` prefix, NOT `WoWWarrior_*`)
5. **Test**: Create/run PowerShell validation script
6. **Document**: Update transformation status in `SOURCE_OF_TRUTH.md`

### **3. Test Creation Protocol** (NEW - Critical)
For EVERY file transformed (FILES 1-15):
1. Create `Test-{FileName}.ps1` in `Transformation_Templates/Tests/`
2. Follow pattern from `Test-MetaLsx.ps1` / `Test-ClassDescriptions.ps1`
3. Strip multi-line XML comments: `$Content -replace '(?s)<!--.*?-->', ''`
4. Use `[PASS]`/`[FAIL]`/`[WARN]`/`[INFO]` (NO Unicode emoji)
5. Show context before validation (`Write-Info` then `Write-Pass/Fail`)
6. Add to `Test-AllFiles.ps1` master runner

### **4. Naming Conventions** (Critical - Crashes if Wrong)
- **Abilities**: `WAR_AbilityName` (e.g., `WAR_Charge`, `WAR_Execute`)
- **Spell entries**: `Target_WAR_AbilityName`, `Shout_WAR_AbilityName`
- **Statuses**: `WAR_STATUS_NAME` (e.g., `WAR_SHIELD_BLOCK`)
- **Passives**: `WAR_PassiveName` or `WAR_SpecName_PassiveName`
- **NEVER** use `WoWWarrior_*` prefix (causes passive name mismatch crashes)

### **5. Progression CSV Usage** (Critical for FILE 11)
When working on Progressions.lsx or Section [6]:
1. Open `Warrior Progression for all subclasses and Default hero structure.csv`
2. Identify correct columns:
   - **Arms Baseline**: Cols 4-5
   - **Protection Baseline**: Cols 6-8
   - **Fury Baseline**: Cols 9-10
   - **Class Talents**: Cols 11-23 (shared by all subclasses)
   - **Arms Spec Talents**: Cols 24-36
   - **Fury Spec Talents**: Cols 37-47
   - **Protection Spec Talents**: Cols 48-55
   - **Mountain Thane**: Cols 56-58 (Protection + Fury)
   - **Colossus**: Cols 59-61 (Arms + Protection)
   - **Slayer**: Cols 62-64 (Arms + Fury)
3. Extract unlock levels and ability names
4. Cross-reference with `AbilityDatabase_Warrior_FullyEnriched.csv` for BG3 mechanics

## üéØ Current Session Context

**What We're Doing**: Section [6] Progression documentation (L1-20 tables for 3 subclasses)

**Progress**:
- ‚úÖ Task 1-3: Draft created, scan complete (~4,000 words, 8 subsections)
- ‚è≥ Task 4: **NEXT** - Review draft and get user approval
- ‚è≥ Tasks 5-9: Integration, change log, cross-references, summary, handover

**Critical Deliverables**:
- Section [6.1-6.3]: L1-20 progression tables (Arms, Fury, Protection)
- Section [6.8]: Progressions.lsx Implementation Notes (Zero SpellList approach)
- 58 UUIDs required for FILE 11 (24 SpellLists + 34 PassiveLists)
- `BG3_SPELL_GRANT_APPROACHES.md` reference guide (created)

**After Section [6]**: 76.9% documentation complete (10/13 sections)

## üí° Key Design Patterns

### **Zero SpellList Approach** (Proven by WoWWarlock)
- ClassDescription has dummy SpellList UUID (never defined in SpellLists.lsx)
- Progressions.lsx grants abilities via `AddSpells(UUID)` (references real SpellLists)
- Progressions.lsx grants talents via `SelectPassives(UUID,amount,RowName)`
- Progressions.lsx auto-grants via `PassivesAdded="Talent1;Talent2"`

### **Hero Talent System** (L13-20 Specializations)
- 3 specializations: Mountain Thane, Colossus, Slayer
- Each has 10 talents across 5 tiers (L13, L15, L17, L19, L20)
- Implemented as passive chains (modify existing abilities via conditions)
- Example: `HasPassive('WAR_Colossus_Keystone',context.Source)`

### **BG3 Stat File Format** (Critical Syntax)
```
new entry "Target_WAR_Execute"
type "SpellData"
data "SpellType" "Target"
data "UseCosts" "ActionPoint:1;Rage:20"
data "SpellSuccess" "DealDamage(4d12+StrengthModifier,MainMeleeWeaponDamageType,Magical)"
data "TargetConditions" "HealthPercentage(context.Target) <= 20"
```

## üö´ Common Pitfalls (Learn from Past Sessions)

1. **LSLib Version Mismatch**: Must use v1.20.3+ for Patch 8 (package v18)
2. **Missing Localization Handles**: Silent failures in character creation
3. **Cooldown Syntax**: Use `"OncePerTurn"` NOT `"1Turn"` or numeric
4. **UUID Consistency**: Must match across `meta.lsx`, folder names, all references
5. **PowerShell XML Comments**: Strip multi-line comments BEFORE parsing XML
6. **Naming Crashes**: `WoWWarrior_*` prefix causes passive mismatch crashes

## üîó Quick Reference Links

- **Transformation Plan**: `Reports/FILE_BY_FILE_TRANSFORMATION_PLAN.md`
- **Test Suite**: `Transformation_Templates/Tests/README.md`
- **WoWWarlock Template**: `Tests/02_ExampleMods/ExampleMod_WoWWarlock/`
- **Packaging Guide**: `Documentation/01_Reference-Guides/PACKAGING_GUIDE.md`
- **Project Index**: `INDEX.md` (comprehensive file inventory)

## üìä Project Statistics

- **Documentation**: 69.2% complete (9/13 sections)
- **Abilities**: 215 total (100% enriched with BG3 mechanics)
- **Hero Talents**: 30 (10 per specialization)
- **Implementation**: FILES 1-2 complete, FILE 3 next
- **Test Coverage**: 2 validation scripts, 100% passing

---

**Last Updated**: October 21, 2025  
**Session Focus**: Section [6] Progression integration (Task 4-9 of 9)
