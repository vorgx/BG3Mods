WH.Popover=function(e,t,n){const o=this;const i=WH.DOM;const r=WH.Icon;const l=WH.Layout;const s=WH.Time;const a=WH.Tooltips;const c=540;const d=1;const p="full-width";const m="left";const u="right";const h=Object.seal({afterHideTimeout:undefined,afterShowTimeout:undefined,columnMaxWidth:undefined,elements:Object.seal({closer:undefined,columnContentDivs:[],columnDivs:[],columnsWrapper:undefined,container:undefined,currentTrigger:undefined,header:undefined,popover:undefined,positionalContainer:undefined,trigger:undefined}),headerLightboxOnly:false,lightbox:false,lightboxBreakpoint:c,lightboxEnabled:undefined,options:undefined,pixelGap:0,renderCallback:undefined,rendered:false,triggerRemovalObserver:undefined,visible:false});this.addColumn=()=>{let e=WH.ae(h.elements.columnsWrapper,WH.ce("div",{className:"popover-column"}));h.elements.columnDivs.push(e);let t=WH.ae(e,WH.ce("div",{className:"popover-column-content"}));h.elements.columnContentDivs.push(t);return t};this.createDivider=e=>{let t=WH.ce("div",{className:"popover-divider"});if(e){WH.ae(e,t)}return t};this.destroy=()=>{o.hide();WH.de(h.elements.container);WH.dE(document,"click",W);WH.dE(document,"keydown",H);h.rendered=false};this.getColumns=()=>h.elements.columnContentDivs;this.getCurrentTrigger=()=>h.elements.currentTrigger;this.hide=e=>{if(!h.visible){return}h.options.onHide?.(h.elements.columnContentDivs[0],o);h.afterHideTimeout=setTimeout(C,s.ANIMATION_SPEED_FAST_MS);h.elements.container.dataset.visible="false";h.visible=false;if(h.elements.currentTrigger){h.elements.currentTrigger.dataset.popoverVisible="false";if(i.isInView(h.elements.currentTrigger)){h.elements.currentTrigger.focus()}h.elements.currentTrigger=undefined}a.hide();if(e){e.preventDefault();e.stopPropagation()}};this.show=e=>{if(h.visible){o.hide(e);return}h.elements.currentTrigger=e.target;h.triggerRemovalObserver??=new MutationObserver((()=>{if(h.elements.currentTrigger&&!document.body.contains(h.elements.currentTrigger)){o.hide()}}));if(i.getData(h.elements.currentTrigger,"popoverResizeAttached")!==true){WH.aE(h.elements.currentTrigger,"resize",(()=>{if(!h.visible){return}if(!i.isVisible(h.elements.currentTrigger)){o.hide()}}));i.setData(h.elements.currentTrigger,"popoverResizeAttached",true)}E()};this.skipHideAnimation=()=>{const e=()=>{C();h.elements.popover.style.display="none";requestAnimationFrame((()=>h.elements.popover.style.display=null))};if(h.visible){setTimeout((()=>!h.visible&&e()));return}e()};function f(){return!!(h.options.headerContent||h.options.headerText||h.options.headerBackground?.image)}function g(e,t,n={}){h.elements.trigger=e;h.headerLightboxOnly=n.headerLightboxOnly??h.headerLightboxOnly;h.lightbox=n.lightbox===true;h.lightboxBreakpoint=n.lightboxBreakpoint??c;h.options=n;h.renderCallback=t;if(h.elements.trigger){WH.aE(h.elements.trigger,"click",o.show)}}function v(){WH.aE(h.elements.container,"resize",(()=>{if(!h.visible){return}I()}));WH.aE(document,"click",W);WH.aE(document,"keydown",H)}function W(e){if(!h.visible){return}if(e?.button!=null&&e.button!==0){return}if(e?.target&&(e.target.closest(".popover")||h.elements.currentTrigger?.contains(e.target))||e?.target?.id&&WH.qs(`#${e.target.id}`,h.elements.popover)){return}o.hide(e)}function H(e){if(!h.visible){return}if(e.key==="Escape"){o.hide(e)}}function b(){const e=["popover-wrapper"];h.elements.container=WH.ce("div",{className:e.join(" ")});WH.ae(document.body,h.elements.container);if(h.options.slidePosition){T(h.options.slidePosition)}const t={hasHeader:`${f()}`};if(h.options.fullWidth){t.fullWidth=h.options.fullWidth}if(h.options.popoverName){t.name=h.options.popoverName}h.elements.popover=WH.ae(h.elements.container,WH.ce("div",{className:"popover",dataset:t}));h.elements.closer=new WH.Button({"aria-label":WH.TERMS.close,"data-button-type":"popover-closer","data-variation":WH.getDataTreeKey(),clickHandler:o.hide,iconConfig:{faIcon:{prefix:"fas",name:"xmark"}},size:"small",style:"secondary"}).getElement();a.attachNonTouch(h.elements.closer,WH.TERMS.close,"q10");h.elements.columnsWrapper=WH.ae(h.elements.popover,WH.ce("div",{className:"popover-columns"}));o.addColumn();h.columnMaxWidth=parseInt(getComputedStyle(h.elements.columnDivs[0]).maxWidth);if(f()){h.elements.header=WH.aef(h.elements.columnDivs[0],WH.ce("div",{className:"popover-header"}));if(h.options.headerIcon){let e;if(/^https?:\/\//.test(h.options.headerIcon)){e=h.options.headerIcon}else{e=(""+h.options.headerIcon).startsWith("/")?WH.Url.generateStatic(h.options.headerIcon):r.getIconUrl(h.options.headerIcon,r.LARGE,WH.Game.getEnv(h.options.headerIconGame))}let t=WH.ae(h.elements.header,WH.ce("div",{className:"popover-header-icon"}));WH.ae(t,WH.ce("div",{className:"popover-header-icon-inner",style:{backgroundImage:`url('${e}')`}}));h.elements.header.dataset.hasIcon="true"}else{h.elements.header.dataset.hasIcon="false"}let e;if(h.options.headerContent){e=WH.ce("div",{className:"popover-header-content"},h.options.headerContent)}else{e=WH.ce("div",{className:"popover-header-text"},WH.ct(h.options.headerText??""));if(h.options.headerTextSubtitle){WH.ae(e,WH.ce("div",{className:"popover-header-text-subtitle"},WH.ct(h.options.headerTextSubtitle)))}}WH.ae(h.elements.header,e);if(h.options.headerBackground?.image){let e;if(/^https?:\/\//.test(h.options.headerBackground.image)){e=h.options.headerBackground.image}else{e=h.options.headerBackground.image.startsWith("/")?WH.Url.generateStatic(h.options.headerBackground.image):null}if(e){h.elements.header.style.backgroundImage=`url('${e}')`;if(h.options.headerBackground.aspectRatio){h.elements.header.style.aspectRatio=h.options.headerBackground.aspectRatio}}}x(true)}else{x(false)}h.pixelGap=parseInt(getComputedStyle(h.elements.columnsWrapper).gap);if(document.fullscreenElement){WH.ae(document.fullscreenElement,h.elements.container)}document.addEventListener("fullscreenchange",(()=>{WH.ae(document.fullscreenElement??document.body,h.elements.container)}))}function x(e){if(e){WH.ae(h.elements.header,h.elements.closer)}else{WH.aef(h.elements.popover,h.elements.closer)}}function y(e){if(h.lightboxEnabled===e){return e}h.lightboxEnabled=e;h.elements.container.dataset.lightbox=`${e}`;let t=!!(f()&&(e||!h.headerLightboxOnly));h.elements.popover.dataset.hasHeader=`${t}`;x(t);if(e){h.elements.popover.style.left=null;h.elements.popover.style.right=null;h.elements.popover.style.top=null;h.elements.popover.style.width=null;h.elements.columnDivs.forEach((e=>e.style.width=null));k(true)}if(e){new WH.ScrollFade(h.elements.popover)}return e}function T(e){h.elements.container.dataset.slidePosition=e}function w(e,t,n){switch(e){case p:h.elements.popover.style.left=`${h.pixelGap}px`;h.elements.popover.style.right=`${h.pixelGap}px`;h.elements.popover.style.width=`calc(100% - ${2*h.pixelGap}px)`;break;case m:h.elements.popover.style.left=`${n}px`;h.elements.popover.style.right="auto";h.elements.popover.style.width=`${t}px`;break;case u:h.elements.popover.style.left="auto";h.elements.popover.style.right=`${n}px`;h.elements.popover.style.width=`${t}px`;break;default:throw new Error(`Attempted to set invalid Popover position. [${e}]`)}}function k(e){h.elements.popover.dataset.verticalLayout=`${e}`}function E(){let e=!h.rendered;if(e){h.rendered=true;b();v();h.elements.positionalContainer=(()=>{let e=WH.ge("main-contents");if(e?.contains(h.elements.currentTrigger)){return e}let t=l.getElement("header");if(t?.contains(h.elements.currentTrigger)){return t}let n=WH.qs("footer.footer");if(n?.contains(h.elements.currentTrigger)){return n}return document.body})()}h.elements.container.dataset.visible="true";h.elements.currentTrigger.dataset.popoverVisible="true";h.visible=true;if(e){h.renderCallback(h.elements.columnContentDivs[0],o)}h.options.onShow?.(h.elements.columnContentDivs[0],o);h.afterShowTimeout=setTimeout(D,s.ANIMATION_SPEED_FAST_MS);I();h.elements.closer.focus()}function C(){clearTimeout(h.afterHideTimeout);h.options.afterHide?.(h.elements.columnContentDivs[0],o)}function D(){clearTimeout(h.afterShowTimeout);h.options.afterShow?.(h.elements.columnContentDivs[0],o)}function I(){if(h.lightbox){y(true);return}let e=h.elements.positionalContainer.getBoundingClientRect();let t=e.width;if(y(t<=h.lightboxBreakpoint)){return}const n=h.options.direction||"vertical";const o=h.options.openInverted;let i=h.elements.currentTrigger.getBoundingClientRect();let r=window.scrollX;let l=window.scrollY;let s=h.elements.popover.offsetWidth;let a;if(n==="horizontal"){let e=window.innerWidth-i.right;let t=i.left;let n=i.top+l;if(o){a=i.left+r-s-10}else{a=i.right+r+10}if(!o&&e<s&&t>=s){a=i.left+r-s-10}else if(!o&&e<s&&t<s){a=Math.max(r+10,Math.min(i.left+r,window.innerWidth-s-10))}h.elements.popover.style.left=`${a}px`;h.elements.popover.style.top=`${n}px`;h.elements.popover.style.right="auto"}else{const e=h.elements.popover.offsetHeight;const t=o?i.top+l-e-10:i.bottom+l+10;h.elements.popover.style.top=`${t}px`;h.elements.popover.style.left="auto";h.elements.popover.style.right="auto"}h.elements.popover.style.width=null;let c=h.elements.columnDivs;c.forEach((e=>e.style.width=null));let f=Math.min(c.reduce(((e,t)=>Math.max(e,t.offsetWidth)),0)+d,h.columnMaxWidth);c.forEach((e=>e.style.width=`${f}px`));let g=f;let v=t-2*h.pixelGap;let W=c.length;let H=1;if(W>1){let e=W*f+(W-1)*h.pixelGap;if(e<v){g=e;H=W}}if(n==="horizontal"){if(o){w(m,s,a)}else{w(u,s,window.innerWidth-(a+s))}}else{if(g>=v){w(p)}else{let t=i.left+r+i.width/2;let n=t-g/2;let o=r+e.left+h.pixelGap;if(n+g>o+v){w(u,g,h.elements.container.offsetWidth-(r+e.right)+h.pixelGap)}else{w(m,g,Math.max(n,r+e.left+h.pixelGap))}}}k(W>1&&H===1)}g.apply(this,arguments)};