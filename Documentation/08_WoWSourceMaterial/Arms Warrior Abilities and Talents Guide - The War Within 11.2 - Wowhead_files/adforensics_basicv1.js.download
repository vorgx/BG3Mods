var amzntqcsm;(amzntqcsm=amzntqcsm||{}).errorCodes={SLOT_INSIDE_UNFRIENDLY_FRAME:1,UNSUPPORTED_BROWSER:2,ERROR_SENDING_PIXEL:3,INVALID_API:4,MALFORMED_URL:5},amzntqcsm.PST_ERROR_CODE={UNSUPPORTED_FEATURE_POLICY:"UNSUPPORTED_FEATURE_POLICY",FEATURE_POLICY_EXCEPTION:"FEATURE_POLICY_EXCEPTION",TOKEN_NOT_PRESENT:"TOKEN_NOT_PRESENT",TUNGSTEN_LOGGING_ERROR:"TUNGSTEN_LOGGING_ERROR",HAS_RR_API_FAILURE:"HAS_RR_API_FAILURE",HAS_TOKEN_API_FAILURE:"HAS_TOKEN_API_FAILURE",TRS_RESPONSE_STATUS_NOT_200:"TRS_RESPONSE_STATUS_NOT_200",REDEMPTION_ERROR:"REDEMPTION_ERROR",SEND_RR_PAYLOAD_ERROR:"SEND_RR_PAYLOAD_ERROR"},amzntqcsm.errors=[],amzntqcsm.errorMessages=[],amzntqcsm.exceptions={},amzntqcsm.reportErrors=function(t){for(var n=0;n<amzntqcsm.errors.length;n++)if(-1===amzntqcsm.errorMessages.indexOf(amzntqcsm.errors[n])){amzntqcsm.errorMessages.push(amzntqcsm.errors[n]);var e='{"adViewability":[{"error": {"m": "'+amzntqcsm.errors[n]+'"}}], "c": "viewability", "api": "'+amzntqcsm.api+'", "error": 1}';amzntqcsm.sendPixel(t,e,"")}amzntqcsm.errors=[],amzntqcsm.detachAllHandlers&&amzntqcsm.detachAllHandlers()},amzntqcsm.sendPixel=function(t,n,e){n=n.replaceAll("%","<per>"),n=encodeURIComponent(n);var r="?";void 0!==e&&""!==e?t+=e:(t+="?p=",r="&"),(new Image).src=t+n+r+"cb="+Math.round(1e7*Math.random())},function(){var g=/\(?([^\s]*):(\d+):\d+\)?/,u=/.*@(.*):(\d*)/;function l(t,n){try{return t[n]}catch(t){return""}}amzntqcsm.constructErrorMessage=function(t,n){if(n=n||{},!t)return{};t.m&&t.m.message&&(t=t.m);var e,r,s,a,m,o,i={m:function(t,n){var e=n.m||n.message||"";t.m&&t.m.message?e+=t.m.message:t.m&&t.m.target&&t.m.target.tagName?e+="Error handler invoked by "+t.m.target.tagName+" tag":t.m?e+=t.m:t.message?e+=t.message:e+="Unknown error";return e}(t,n),c:t.c?""+t.c:t.c,s:[],l:t.l||t.line||t.lineno||t.lineNumber,name:t.name,type:t.type},c=0,d=0;if((e=t.stack||(t.err?t.err.stack:""))&&e.split)for(r=e.split("\n");c<r.length&&i.s.length<20;)(s=r[c++])&&i.s.unshift((o=s)?o.replace(/^\s+|\s+$/g,""):o);else for(a=l(t.args||arguments,"callee"),d=c=0;a&&c<20;)m=256,a.skipTrace||(s=a.toString())&&s.substr&&(m=0===d?1024:m,m=1===d?512:m,i.s.unshift(s.substr(0,m)),d++),a=l(a,"caller"),c++;return!i.f&&0<i.s.length&&function(t){if(t&&t.s){var n,e=0<t.s.length?t.s[0]:"",r=1<t.s.length?t.s[1]:"";e&&(n=e.match(u)),n&&3===n.length||!r||(n=r.match(g)),n&&3===n.length&&(t.f=n[1],t.l=n[2])}}(i),i}}(),amzntqcsm.exceptions.invalidModuleException=function(t){this.value=t,this.message="does not conform to the expected format of a module",this.toString=function(){return this.value+this.message}},amzntqcsm.exceptions.invalidStringException=function(t){this.value=t,this.message="should be a string. Pixel Queue expects a string.",this.toString=function(){return this.value+this.message}},amzntqcsm.getModules=function(t,n,e){return{utils:{default:!0,params:[],global:!0},pixelQueue:{default:!0,params:[n]}}},amzntqcsm.log=function(t){try{-1!==window.location.href.indexOf("csm_debug_mode")&&window.console&&window.console.log(t)}catch(t){t.message&&amzntqcsm.errors.push(t.message)}},amzntqcsm.loadModules=function(t,n){try{for(var e=0;e<n.length;e++){var r=n[e].name,s=n[e].params||[];if(window.performance&&window.performance.mark&&"function"==typeof window.performance.mark&&window.performance.mark("loadStart"+r+t),"[object Array]"!==Object.prototype.toString.call(s)&&amzntqcsm.log("Params passed in the amzntqcsm.loadModules methods must be an array"),amzntqcsm[r]){if(void 0===amzntqcsm[r].shortName)throw new amzntqcsm.exceptions.invalidModuleException("Module shortName not defined for module "+r+". ");s.unshift(t),amzntqcsm[r].init.apply(amzntqcsm[r],s),amzntqcsm.log("Initiated "+r+" module"),window.performance&&window.performance.mark&&"function"==typeof window.performance.mark&&(window.performance.mark("loadEnd"+r+t),window.performance.measure("lt"+amzntqcsm[r].shortName+t,"loadStart"+r+t,"loadEnd"+r+t))}else amzntqcsm.log("Undefined module "+r)}}catch(t){t.message&&amzntqcsm.errors.push(t.message)}},amzntqcsm.define=function(t){try{for(var n=Array.prototype.slice.call(arguments),e=n[0],r=2<n.length?n[1]:[],s=n[n.length-1],a=[],m=0,o=r.length;m<o;m++)a.push("string"==typeof(i=r[m])?amzntqcsm[i]:i);amzntqcsm[e]=s.apply(s,a)}catch(t){t.message&&amzntqcsm.errors.push(t.message)}var i},amzntqcsm.define("utils",[],function(){var t,a={shortName:"ut"};return a.init=function(t){amzntqcsm.log("Initializing utils for "+t)},a.getPixelID=(t=null,function(){return null===t&&(t=Math.random().toString(36).substr(2)),t}),a.detachAllHandlers=function(){for(var t,n=0;n<amzntqcsm.eventHandlers.length;n++)t=amzntqcsm.eventHandlers[n],amzntqcsm.removeEvent(t.elem,t.eventName,t.cb)},a.reportClientError=function(t){var n=t===parseInt(t,10)?'{"m": "'+t+'"}':JSON.stringify(amzntqcsm.constructErrorMessage(t)),e=amzntqcsm.instrURL,r='{"adViewability":[{"error": '+n+'}], "c": "viewability", "api": "'+amzntqcsm.api+'", "error": 1}';amzntqcsm.log("ERROR "+n),-1===amzntqcsm.errorMessages.indexOf(n)&&(amzntqcsm.errorMessages.push(n),amzntqcsm.scrollImitationTimer&&clearInterval(amzntqcsm.scrollImitationTimer),amzntqcsm.isV6?amzntqcsm.sendPixel(e,r,""):(new Image).src=e+r+"?cb="+Math.round(1e7*Math.random()))},a.isPSTTenant=function(t){return t===amzntqcsm.tungstenTenants.pstErrorLoggingEvent||t===amzntqcsm.tungstenTenants.pstRRLoggingEvent},a.getTungstenCSMLoggingFrameworkBaseUrl=function(t){var n=t.indexOf("/");return 0<n?t.substring(0,n):t},a.getTungstenLoggingHost=function(t,n){return a.isPSTTenant(n)&&(t=a.getTungstenCSMLoggingFrameworkBaseUrl(t),n===amzntqcsm.tungstenTenants.pstErrorLoggingEvent&&(t+="/pstLogError/"),n===amzntqcsm.tungstenTenants.pstRRLoggingEvent&&(t+="/postPstRR/")),t},a.setTimeout=function(t,n){return setTimeout(function(){try{t.call()}catch(t){t.message&&amzntqcsm.log("Error: "+t.message),a.reportClientError(t)}},n)},a.setInterval=function(t,n){return setInterval(function(){try{t.call()}catch(t){t.message&&amzntqcsm.log("Error: "+t.message),a.reportClientError(t)}},n)},a.encr=function(t){if(null==t||""==t||null==t)return t;var n,e,r="",s="",a=t.length,m=Math.floor(a/2);for(n=0,e=m;n<m&&e<a;n++,e++)r+=t.charAt(n)+t.charAt(e);for(a%2==1&&(r+=t.charAt(t.length-1)),n=0;n<a;n++)s+=String.fromCharCode(r.charCodeAt(n)+r.charCodeAt(n)%5);return encodeURIComponent(s)},a.postRequest=function(n,t,e,r){var s=new Headers({"Content-Type":"application/json"}),a=r||{cache:"no-cache",method:"POST",body:JSON.stringify(t),headers:s};fetch(n,a).then(function(t){if(200!==t.status)throw new Error("Received "+t.status+" for "+n)}).catch(function(t){e&&e(t)})},a.logToTungsten=function(t,n,e){try{if(!amzntqcsm.tungstenCSMLoggingFrameworkUrl)return;if(!amzntqcsm.bidId)throw new Error("bidId is not set");var r=a.getTungstenLoggingHost(amzntqcsm.tungstenCSMLoggingFrameworkUrl,n),s=r.startsWith("http")?"":"https://";amzntqcsm.postRequest(s+r+n,t,function(t){amzntqcsm.reportErrorToTungsten(t,n)},e)}catch(t){amzntqcsm.reportErrorToTungsten(t,n)}},a.reportErrorToTungsten=function(t,n){try{a.isPSTTenant(n)&&(n=amzntqcsm.tungstenTenants.pstErrorLoggingEvent);var e=amzntqcsm.createErrorPayloadForTenant(t,n);if(!amzntqcsm.tungstenCSMLoggingFrameworkUrl)return;var r=a.getTungstenLoggingHost(amzntqcsm.tungstenCSMLoggingFrameworkUrl,n),s=r.startsWith("http")?"":"https://";amzntqcsm.postRequest(s+r+n,e,function(t){amzntqcsm.reportClientError(t)})}catch(t){amzntqcsm.reportClientError(t)}},a.createErrorPayloadForTenant=function(t,n){var e={};switch(n){case"3pCsmEvent":e=[{ver:amzntqcsm.version,ts:(new Date).getTime(),error:1,bidId:amzntqcsm.bidId||"",fmp:t===parseInt(t,10)?{m:"' + ex + '"}:amzntqcsm.constructErrorMessage(t)}];break;case"pstErrorLoggingEvent":var r=t===parseInt(t,10)?{m:"' + ex + '"}:amzntqcsm.constructErrorMessage(t);e=[{bidId:amzntqcsm.bidId||"",timeStamp:Date.now(),failureFunction:amzntqcsm.PST_ERROR_CODE.TUNGSTEN_LOGGING_ERROR,errorStackTrace:JSON.stringify(r)}];break;case"3pNtdEvent":e=[{ver:amzntqcsm.version,bidId:amzntqcsm.bidId||"",error:JSON.stringify(t===parseInt(t,10)?{m:"' + ex + '"}:amzntqcsm.constructErrorMessage(t)),ntd:{}}];break;default:throw new Error("Invalid TenantId For Tungsten")}return e},a}),amzntqcsm.define("pixelQueue",[],function(){var r={shortName:"pq"};r.init=function(t,n){amzntqcsm.csmReport.pq={queue:[],instrURL:n}},r.firePixel=function(t,n){var e=amzntqcsm.csmReport.pq.instrURL;if(!1!==a(t)){try{var r=JSON.parse(t);if(r.ver=amzntqcsm.version,t=JSON.stringify(r),!0===window.amzntqcsm.bnmk){var s={bnmk:{pixelId:r.pixelId,iframeId:document.body.getAttribute("data-absoluteparentid")}};amzntqcsm.sendPixel(e+"bnmk/",JSON.stringify(s),""),window.amzntqcsm.bnmk=!1}}catch(t){}amzntqcsm.sendPixel(e,t,n)}},r.logForensicsCsmToTungsten=function(t){try{var n=[{ver:amzntqcsm.version,ts:(new Date).getTime(),error:0,bidId:amzntqcsm.bidId,fmp:t}];amzntqcsm.logToTungsten(n,amzntqcsm.tungstenTenants.forensicsCsmEvent)}catch(t){amzntqcsm.log("Error in logging CSM payload to tungsten "+t.toString()),amzntqcsm.reportErrorToTungsten(t,amzntqcsm.tungstenTenants.forensicsCsmEvent)}};function s(){var t=amzntqcsm.csmReport.pq;0<t.queue.length&&(t.queue=[])}var a=function(t){var n="";if(!1!=("string"==typeof t||t instanceof String))return!0;n="Expected string: but "+typeof t+"found. ","object"==typeof t&&(n+=JSON.stringify(t));try{throw new amzntqcsm.exceptions.invalidStringException(n)}catch(t){amzntqcsm.reportClientError(t)}return!1};return r.addPixel=function(t){var n=this,e=amzntqcsm.csmReport.pq;!1!==a(t)&&(amzntqcsm.log("Received pixel "+t),0===e.queue.length&&amzntqcsm.setTimeout(function(){0<e.queue.length&&(n.send(),s())},2500),e.queue.push(JSON.parse(t)),4<=e.queue.length&&(n.send(),s()))},r.send=function(){var t=amzntqcsm.getPixelID(),n=(new Date).getTime(),e=amzntqcsm.csmReport.pq;0<e.queue.length&&r.firePixel('{"adCsm": '+JSON.stringify(e.queue)+', "pixelId": "'+t+'", "ts": '+n+"}","")},r}),(amzntqcsm=amzntqcsm||{}).rm=function(){amzntqcsm.version="r-1.36";var d={RTB:{fraudMetrics:!(amzntqcsm.tungstenTenants={forensicsCsmEvent:"3pCsmEvent",pstRRLoggingEvent:"pstRRLoggingEvent",pstErrorLoggingEvent:"pstErrorLoggingEvent",forensicsNtdEvent:"3pNtdEvent"}),domainMask:!1,funcSpoofing:!1,headlessBrowser:!0,privateStateToken:!0},DTB:{fraudMetrics:!1,domainMask:!1,funcSpoofing:!1,headlessBrowser:!1,privateStateToken:!1},ONO:{fraudMetrics:!1,domainMask:!1,funcSpoofing:!1,headlessBrowser:!1,privateStateToken:!1},supportedBrowsers:{IE:!0,Firefox:!0,Chrome:!0,Safari:!0,Other:!0}};amzntqcsm.config=d;var o=function(){if(window.amzntqcsm.tungstenCSMLoggingFrameworkUrl){amzntqcsm.tungstenCSMLoggingFrameworkUrl=window.amzntqcsm.tungstenCSMLoggingFrameworkUrl,amzntqcsm.bidId=window.amzntqcsm.bidId;var t={tungstenCSMLoggingFrameworkUrl:amzntqcsm.tungstenCSMLoggingFrameworkUrl,bidId:amzntqcsm.bidId};window.parent.postMessage(JSON.stringify(t),"*");var n=0,e=setInterval(function(){5<=n++?clearInterval(e):window.parent.postMessage(JSON.stringify(t),"*")},2e3)}},i=function(t,n,e,r,s,a){var m=amzntqcsm.getModules(n,e,r,s);for(var o in m)if(m.hasOwnProperty(o)){var i=m[o];if((!0===i.default||!0===d[t][o])&&(amzntqcsm.loadModules(a,[{name:o,params:i.params}]),!0===i.global))for(var c in amzntqcsm[o])amzntqcsm[o].hasOwnProperty(c)&&(amzntqcsm[c]=amzntqcsm[o][c])}};return function(t){var n=t.e,e=t.i,r=t.w,s=t.d,a=Math.round(1e7*Math.random()).toString();if(amzntqcsm.csmReport=amzntqcsm.csmReport||{},o(),i(amzntqcsm.api,n,e,r,s,a),"DTB"===amzntqcsm.api||"RTB"===amzntqcsm.api||"ONO"===amzntqcsm.api){var m=new amzntqcsm.detectSignals(n,e,r,s,a);m.collectData&&m.collectData()}}}(),amzntqcsm.SOURCE_IDS={TWITCH_SOURCE_IDS:["650","651","652","654"]},amzntqcsm.TUNGSTEN_NTD_TENANTS={twitchNtdEvent:"twitchNtdEvent"},amzntqcsm.VENDOR_KEY="amazon.com-omid",amzntqcsm.verificationClientConfig={url:"https://c.amazon-adsystem.com/bao-csm/mobile/ovc.js",version:"1.3.2"},amzntqcsm.getTungstenNtdTenant=function(t){return-1!==amzntqcsm.SOURCE_IDS.TWITCH_SOURCE_IDS.indexOf(t)?amzntqcsm.TUNGSTEN_NTD_TENANTS.twitchNtdEvent:""},amzntqcsm.detectSignals=function(t,n,e,r,s){amzntqcsm.log=function(t){try{self.debug&&window.console&&window.console.log(t)}catch(t){}};this.collectData=function(){!function(){if(window.amzntqcsm.tsEndpoint||window.amzntqcsm.tungstenEndpoint){var t=/\/x\/px\/(.*)\//g.exec(amzntqcsm.instrURL),n="";null!=t&&2<=t.length&&(n=t[1]);var e="?imp="+n+"&d="+amzntqcsm.api+"&cb="+Math.round(1e7*Math.random());window.amzntqcsm.bidRequestId&&(e+="&bidR="+window.amzntqcsm.bidRequestId),window.amzntqcsm.bidId&&(e+="&bid="+window.amzntqcsm.bidId),window.amzntqcsm.tsEndpoint&&((new Image).src=window.amzntqcsm.tsEndpoint+e),window.amzntqcsm.tungstenEndpoint&&((new Image).src=window.amzntqcsm.tungstenEndpoint+e)}if(window.amzntqcsm.ntdUrl){var r={ver:amzntqcsm.version,bidId:amzntqcsm.bidId||""};""==amzntqcsm.tungstenNtdTenantId?amzntqcsm.postRequest("https://"+window.amzntqcsm.ntdUrl+"collect_ntd",r,function(t){}):amzntqcsm.postRequest("https://"+window.amzntqcsm.ntdUrl+"collect_ntd/"+window.amzntqcsm.tungstenNtdTenantId,r,function(t){})}}()}},amzntqcsm.extend=function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t.prototype[e]=n[e])},window.amzntqcsm.rmR=function(t,n){amzntqcsm.api="RTB",startTqCsmComp(t,n)};var startTqCsmComp=function(n,t){try{function e(t){return"complete"===t.readyState}var r=function(t){t.message&&(amzntqcsm.errors.push(t.message),amzntqcsm.reportErrors(n))},s=t,a=s.document;e(a)?amzntqcsm.rm({e:s,i:n,w:s,d:a}):void 0===document.onreadystatechange?amzntqcsm.rm({e:s,i:n,w:s,d:a}):a.addEventListener("readystatechange",function(){try{e(a)&&amzntqcsm.rm({e:s,i:n,w:s,d:a})}catch(t){r(t)}})}catch(t){r(t)}};amzntqcsm.getSanitizedInstrUrl=function(t){return!1===/^https?:\/\//.test(t)&&(t="https:"+(/^\/\//.test(t)?"":"//")+t),"/"!==t.substr(t.length-1)&&(t+="/"),!0===/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),t},amzntqcsm.getElement=function(t){if(!t||"window"===t)return window;var n=t.match(/^document\.getElementById\(['"]([a-zA-Z0-9_-]+)['"]\)$/);return n&&1<n.length?document.getElementById(n[1]):window},amzntqcsm.injectJSResource=function(e,r,s,a){var m=0;!function t(){if(e&&e.body&&"function"==typeof e.body.appendChild){var n=e.createElement("script");s&&(n.onload=s),n.onerror=function(){m<=a&&(m+=1,t())},n.src=r,e.body.appendChild(n)}else m<=a&&(m+=1,setTimeout(t,100))}()},amzntqcsm.processOMSDKAndInitiate=function(){try{if(window.OmidVerificationClient&&amzntqcsm.verificationClientConfig.version in window.OmidVerificationClient){var t=new window.OmidVerificationClient[amzntqcsm.verificationClientConfig.version];"true"===(!0===t.isSupported()?"true":"false")&&t.registerSessionObserver(function(t){try{if(t&&t.type&&"sessionStart"===t.type&&t.data.verificationParameters){var n=JSON.parse(t.data.verificationParameters);amzntqcsm.ntdUrl=n.ntdUrl,amzntqcsm.bidId=n.bidId,amzntqcsm.instrURL=n.instrUrl,amzntqcsm.tungstenNtdTenantId=amzntqcsm.getTungstenNtdTenant(n.sourceid);var e=amzntqcsm.getElement(n.targetElement);window.amzntqcsm.rmR(amzntqcsm.instrURL,e)}}catch(t){}},amzntqcsm.VENDOR_KEY)}}catch(t){}},amzntqcsm.parseUrlParams=function(t){var n={};if(!t)return n;var e=t.split("?")[1];if(e)for(var r=e.split("&"),s=0;s<r.length;s++){var a=r[s].split("=");if(2<=a.length){var m=a[0],o=a[1];if(m&&/^[a-zA-Z0-9_-]+$/.test(m)&&void 0!==o)try{var i=decodeURIComponent(o).replace(/[<>"'&]/g,"");n[m]=i}catch(t){continue}}}return n},amzntqcsm.init=function(){var t="undefined"!=typeof window&&window&&window.document||document;if(t){var n=amzntqcsm.parseUrlParams(t.currentScript.src);if(amzntqcsm.instrURL=amzntqcsm.getSanitizedInstrUrl(n.instrUrl),amzntqcsm.tsEndpoint=n.tsEndpoint,amzntqcsm.tungstenCSMLoggingFrameworkUrl=n.tungstenCSMLoggingFrameworkUrl,amzntqcsm.ntdUrl=n.ntdUrl,amzntqcsm.bidRequestId=n.bidRequestId,amzntqcsm.bidId=n.bidId,amzntqcsm.zone=n.zone,amzntqcsm.isBen=n.isBen||!1,amzntqcsm.tungstenNtdTenantId=amzntqcsm.getTungstenNtdTenant(n.sourceid)||"",!amzntqcsm.instrURL)throw amzntqcsm.errorCodes.MALFORMED_URL;var e=amzntqcsm.getElement(n.targetElement);if(amzntqcsm.bidId&&amzntqcsm.ntdUrl)amzntqcsm.log("Query params fetched: "+amzntqcsm.instrURL+" : "+amzntqcsm.isBen),window.amzntqcsm.rmR(amzntqcsm.instrURL,e);else{amzntqcsm.injectJSResource(t,amzntqcsm.verificationClientConfig.url,amzntqcsm.processOMSDKAndInitiate,2)}}},amzntqcsm.init();