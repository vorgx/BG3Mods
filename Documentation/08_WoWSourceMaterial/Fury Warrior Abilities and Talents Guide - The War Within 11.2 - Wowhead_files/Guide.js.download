WH.Page.Guide=new function(){const e=this;const t=WH.DOM;const i=WH.LocalStorage;const a=WH.WAS;const n={elements:{interiorSidebar:undefined,sidebarParent:undefined}};this.collapseInteriorSidebar=function(){document.body.dataset.interiorSidebarCollapsed="true";r().classList.remove("scrollable-interior-sidebar")};this.expandInteriorSidebar=function(){delete document.body.dataset.interiorSidebarCollapsed};this.initBody=()=>{let e=r();if(!e){a.fillDynamicUnits();return}WH.qs(".interior-sidebar-content").style.minHeight=e.offsetHeight+"px";let t=WH.qs(".interior-sidebar-inner",e);WH.DynamicFixedElement.init("interior-sidebar",e,{checkCallback:function(e){e.element.dataset.scrolling=JSON.stringify(t.scrollHeight>t.clientHeight)},side:"left",minWidth:768});let i=function(e){if(this.parentNode.dataset.scrolling!=="true"){return}let t=e.deltaY||0;if(t<0&&this.scrollTop===0||t>0&&Math.ceil(this.scrollTop)+this.clientHeight>=this.scrollHeight){e.preventDefault();e.stopPropagation()}};WH.aE(t,"wheel",i,{passive:false,capture:false});WH.aE(t,"touchmove",i);a.fillDynamicUnits()};this.initInteriorSidebarControls=function(){n.elements.sidebarParent=WH.qs(".interior-sidebar-parent");if(!n.elements.sidebarParent){return}let s=WH.qs(".interior-sidebar-header-text-title")?.textContent||WH.TERMS.tableofcontents;let c=WH.qs(".interior-sidebar-header-closer");if(!c){WH.error("The guide interior sidebar collapse control is missing.");return}WH.aE(c,"click",(()=>{i.set(i.KEY_GUIDE_SIDEBAR_STATE,"collapsed");e.collapseInteriorSidebar()}));WH.Tooltips.attachNonTouch(c,WH.ct(WH.term("hide_format",s)),"q2");const l=new WH.Button({ariaLabel:s,"data-variation":WH.getDataTreeKey(),clickHandler:a=>{let n=WH.qs(".markup-toc-button");if(n&&t.isVisible(n)){a.preventDefault();a.stopPropagation();n.dispatchEvent(new Event("click"));return}i.remove(i.KEY_GUIDE_SIDEBAR_STATE);e.expandInteriorSidebar();WH.scrollTo(r(),{asNeeded:true})},iconConfig:{faIcon:{prefix:"fas",name:"list-ul"}},size:"small",style:"primary"}).getElement();WH.aef(r(),l);l.classList.add("interior-sidebar-expand");WH.Tooltips.attachNonTouch(l,WH.ct(s),"q");if(i.get(i.KEY_GUIDE_SIDEBAR_STATE)==="collapsed"){e.collapseInteriorSidebar();return}let d=window.innerWidth;let H=WH.qs(".sidebar");let W=H&&t.isVisible(H)?1350:950;if(d<=WH.Responsive.BREAKPOINTS.MOBILE_MODE||d>=WH.Responsive.INTERIOR_SIDEBAR_REMOVAL_BREAKPOINT&&d<W){e.collapseInteriorSidebar()}else if(a.showAds()){if(a.isSkinned()){e.collapseInteriorSidebar()}else{a.addPostSkinSetupCallback(e.collapseInteriorSidebar)}}o();WH.aE(window,"scroll",(()=>{if(window.innerWidth>WH.Responsive.INTERIOR_SIDEBAR_REMOVAL_BREAKPOINT){return}if(r().offsetHeight===0){return}setTimeout((()=>{if(r().getBoundingClientRect().bottom<=ZUL.HEIGHT){delete l.dataset.tocVisible}else{l.dataset.tocVisible="true"}}))}))};this.initStyling=function(){let e=WH.ge("guide-body");if(!e){WH.error("Guide body not found.");return}e.classList.add("guide-styles");WH.qsa("table[border]",e).forEach((function(e){if(!e.hasAttribute("class")&&e.getAttribute("border")!=="0"){e.classList.add("grid")}}))};this.initPageControlsPopover=e=>{let t=WH.ge("guide-page-controls");if(!t){WH.error("Page Controls not found.");return}const i=WH.ge("admin-button");const a=WH.ge("guide-actions-button");const n=WH.ge("report-button");const o=WH.ge("open-links-button");const r=WH.ge("edit-button");const s=WH.ge("changelog-button");const l=WH.ce("div",{className:"guide-actions"},WH.ce("h6",{},WH.ct(WH.TERMS.actions)));const d=c(e);new WH.Popover(a,(e=>{WH.ae(e,l);WH.ae(e,d)}),{headerContent:WH.ce("div",{className:"guide-actions-header"},[WH.ce("i",{className:"fa fa-ellipsis-v"}),WH.ct(WH.term("actions_format",WH.Types.getUpperSingular(WH.Types.GUIDE)))]),lightbox:true});WH.aE(document.body,"resize",(e=>{const a=e.detail.contentRect.width;if(a<599){i.innerText="";i.dataset.simpleTooltip=WH.TERMS.administrator_abbrev;WH.ae(l,n);n.innerText=WH.TERMS.report;if(r){WH.ae(l,r);r.innerText=WH.TERMS.edit}if(s){WH.ae(l,s);s.innerText=WH.TERMS.changelog}WH.ae(d,o)}else{if(i){i.innerText=WH.TERMS.administrator_abbrev;delete i.dataset.simpleTooltip}if(s){s.innerText="";WH.aef(t,s)}if(r){r.innerText="";WH.aef(t,r)}WH.aef(t,o);n.innerText="";WH.aef(t,n)}}))};function o(){const e=WH.ge("interior-sidebar-related-markup");if(!e){WH.error("Sidebar not found.");return}const t=WH.Game.getKey(WH.Game.get());const i=WH.qsa('b, [class^="heading-size-"]',e);i.forEach(((e,i)=>{const a=e.firstChild;const n=a?.nodeType===Node.ELEMENT_NODE&&["iconsmall","iconmedium","iconlarge","markup-symbol"].some((e=>a.classList.contains(e)));if(e.hasChildNodes()&&!n){const a=WH.ce("div",{className:"iconmedium",dataset:{game:t,kind:t==="wow"?"round":"diamond"}},WH.ce("ins",{dataset:{sectionNumber:`${i+1}`}}));WH.aef(e,a)}}))}function r(){return n.elements.interiorSidebar??=WH.qs(".interior-sidebar")}const s=()=>{const e=WH.getPageData("guide.aboutTheAuthor.embedData");if(e){WH.React.initComponent(WH.ge("authorembed"),"modules/about-the-author/AuthorEmbed",{author:e})}};function c(e){const t=WH.ce("div",{className:"share-actions"},WH.ce("h6",{},WH.ct(WH.TERMS.copy_clipboard)));const i=WH.ce("a",{className:"btn btn-medium btn-dark fa fa-link"},WH.ct(WH.term("copy_format",WH.TERMS.link)));WH.aE(i,"click",WH.copyToClipboard.bind(null,location.href));WH.ae(t,i);const a=WH.ce("a",{className:"btn btn-medium btn-dark fa fa-hashtag"},WH.ct(WH.term("copy_format",WH.term("parens_format",WH.term("id_format",WH.Types.getUpperSingular(WH.Types.GUIDE)),e))));WH.aE(a,"click",WH.copyToClipboard.bind(null,e));WH.ae(t,a);let n=WH.getPageData("links.copyMenuItems");n?.forEach((e=>{const i=WH.ce("a",{className:`btn btn-medium btn-dark fa fa-${e.fontIcon??"clipboard"}`},WH.ct(WH.term("copy_format",e.label)));WH.aE(i,"click",WH.copyToClipboard.bind(null,e.value));WH.ae(t,i)}));WH.ae(t,WH.ce("h6",{},WH.ct(WH.TERMS.share)));const o=WH.ce("div",{className:"share-services"});WH.ae(t,o);WH.ShareServices.getShareServices(location.href,WH.ShareServices.getSubredditByGame(WH.Game.get())).forEach((e=>{const t=WH.ae(o,WH.ce("a",{className:"btn btn-medium btn-dark",href:e.url,target:"_blank"}));const i=WH.ae(t,WH.ce("i"));WH.React.initComponent(i,"modules/FontIcon",{faIcon:e.fontIcon})}));return t}WH.Page.registerInit(s)};